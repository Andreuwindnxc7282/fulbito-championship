name: Deploy Fulbito Championship

on:
  push:
    branches: [ main ]

jobs:
  deploy-info:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Display deployment info
      run: |
        echo "ðŸš€ Deployment ready!"
        echo "âœ… Backend: Deploy manually to Render"
        echo "âœ… Frontend: Deploy manually to Vercel"
        echo "âœ… Repository: https://github.com/${{ github.repository }}"
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: |
        npm install
    
    - name: Run linting
      run: |
        npm run lint
    
    - name: Run tests
      run: |
        npm run test
    
    - name: Build
      run: |
        npm run build

  deploy-backend:
    needs: test-backend
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Railway
      uses: bervProject/railway-deploy@v1.0.0
      with:
        railway_token: ${{ secrets.RAILWAY_TOKEN }}
        service: fulbito-backend

  deploy-frontend:
    needs: test-frontend
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Vercel
      uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        working-directory: ./frontend
